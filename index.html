<!DOCTYPE html>
<!-- å£°æ˜æ–‡æ¡£ç±»å‹ä¸º HTML5 -->
<html>
<head>
    <!-- ç½‘é¡µçš„å¤´éƒ¨ï¼ŒåŒ…å«æ ‡é¢˜å’Œæ ·å¼ -->
    <title>ä½ å·²å å…¥å§‹ç¥–å¤§é™†ï¼</title>
    <style>
        /* è®¾ç½®å…¨å±€æ ·å¼ */
        @font-face {
        font-family: 'zpix';
        src: url('fonts/zpix.woff2') format('woff2');
}
        body {
        font-family: 'zpix', cursive; /* ä¸»åƒç´ å­—ä½“ */
        image-rendering: pixelated; /* ä¿æŒåƒç´ åŒ–æ¸²æŸ“ */
        margin: 0; /* å»é™¤é»˜è®¤çš„ body è¾¹è· */
        padding: 0;
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        transition: background-image 0.5s ease, 
    }
        /* æ¸¸æˆå†…å®¹æ¡†çš„æ ·å¼ */
    .game-box {
        border: 4px solid #2d1b0f; /* æ·±æ£•è‰²è¾¹æ¡† */
        background-color: #e3c9a1; /* ç¾Šçš®çº¸åº•è‰² */
        border-radius: 0; /* ç›´è§’ */
        box-shadow: 8px 8px 0 #2d1b0f55; /* åƒç´ åç§»é˜´å½± */
        font-size: 22px;
        max-width: 600px; /* é€‚å½“åŠ å®½ */
        margin: 0 auto; /* æ°´å¹³å±…ä¸­ */
        padding: 20px; /* å†…è¾¹è· */
        top: 30px; /* å¢åŠ é¡¶éƒ¨é—´è· */
        position: relative; /* ç›¸å¯¹å®šä½ */
    }
    /* æ ‡é¢˜æ ·å¼ */
    h1 {
        font-family: 'zpix', cursive; /* æ ‡é¢˜ä¸“ç”¨åƒç´ å­—ä½“ */
        color: #4a752c; /* æ˜Ÿéœ²è°·ç»¿è‰² */
        text-shadow: 2px 2px #2d1b0f;
    }
    /* æŒ‰é’®åƒç´ åŒ– */
    .choice-btn {
        background-color: #4a752c; /* è‡ªç„¶ç»¿è‰² */
        border: 2px solid #2d1b0f;
        border-radius: 0;
        font-family: 'zpix', cursive;
        font-size: 20px;
        transition: all 0.1s;
        box-shadow: 3px 3px 0 #2d1b0f;
        line-height: 60px; /* ä¿®æ­£å‚ç›´å±…ä¸­ */
    }
    .choice-btn:hover {
        background-color: #6eb300;
        transform: translate(2px, 2px);
        box-shadow: 1px 1px 0 #2d1b0f;
    }
    #character-panel {
        top: 20px;  /* å¢åŠ é¡¶éƒ¨é—´è· */
        left: 20px; /* å¢åŠ å·¦ä¾§é—´è· */
        width: 220px; /* å¢åŠ å®½åº¦ */
        padding: 15px;
        background: #2d1b0f; /* æ·±æ£•è‰²èƒŒæ™¯ */
        border: 4px solid #6eb300; /* æ›´ç²—çš„ç»¿è‰²è¾¹æ¡† */
        border-radius: 0; /* ä¿æŒç›´è§’ */
        font-family: 'zpix', cursive; /* åƒç´ å­—ä½“ */
        font-size: 16px; /* å¢å¤§å­—ä½“ */
        color: #e3c9a1; /* æµ…é»„è‰²æ–‡å­— */
        opacity: 0; /* åˆå§‹ä¸ºé€æ˜ */
        transform: scale(0.9); /* æ¢å¤åŸå§‹å¤§å° */
        box-shadow: 6px 6px 0 #00000033; /* æ·»åŠ é˜´å½± */
        z-index: 1000; /* ç¡®ä¿åœ¨å…¶ä»–å†…å®¹ä¹‹ä¸Š */
        position: fixed; /* å›ºå®šå®šä½ */
        max-height: 90vh; /* æœ€å¤§é«˜åº¦ä¸ºè§†å£çš„90% */
        overflow-y: auto; /* æ·»åŠ å‚ç›´æ»šåŠ¨æ¡ */
    }
    /* é¢æ¿æ ‡é¢˜ */
    #character-panel h3 {
        font-size: 20px; /* å¢å¤§æ ‡é¢˜å­—ä½“ */
        color: #6eb300; /* ç»¿è‰²æ ‡é¢˜ */
        text-shadow: 2px 2px #000000; /* æ·»åŠ æ–‡å­—é˜´å½± */
        margin: 0 0 10px 0; /* è°ƒæ•´æ ‡é¢˜é—´è· */
    }
    #character-panel.show {
        opacity: 1;
    }
    /* çŠ¶æ€æ¡ç›® */
    .status-item {
        background: #4a752c33; /* åŠé€æ˜ç»¿è‰²èƒŒæ™¯ */
        padding: 8px;
        margin: 6px 0;
        border: 2px solid #6eb300; /* ç»¿è‰²è¾¹æ¡† */
        font-size: 16px; /* å¢å¤§çŠ¶æ€å­—ä½“ */
        color: #ffffff; /* ç™½è‰²æ–‡å­— */
    }
    /* æ­¦å™¨å’Œç‰©å“æ  */
    #weapon-container, #inventory-container {
        gap: 6px; /* å¢åŠ é—´è· */
        margin: 10px 0; /* å¢åŠ ä¸Šä¸‹é—´è· */
    }
    .weapon-item, .inventory-item {
        display: flex; /* ä½¿ç”¨ Flexbox å¸ƒå±€ */
        align-items: center; /* å‚ç›´å±…ä¸­ */
        border: 2px solid; /* è¾¹æ¡†æ ·å¼ */
        margin: 5px;
        padding: 8px;
        position: relative;
        color: #ffffff; /* ç™½è‰²æ–‡å­— */
        height: 20px; 
    }
    .item-icon {
        width: 32px;
        height: 32px;
        image-rendering: pixelated;
    }

    /* å“è´¨é¢œè‰²æŒ‡ç¤ºå™¨ */
    .item-quality {
        position: absolute;
        right: 5px;
        top: 5px;
        width: 10px;
        height: 10px;
        border: 1px solid #000;
    }
    /* å® ç‰©é¢æ¿ */
    #pet-panel {
        margin-top: 12px;
        padding: 10px;
        background: #4a752c22; /* åŠé€æ˜ç»¿è‰²èƒŒæ™¯ */
        border: 2px dashed #6eb300; /* ç»¿è‰²è™šçº¿è¾¹æ¡† */
        color: #ffffff; /* ç™½è‰²æ–‡å­— */
        opacity: 1; 
    }
    #pet-panel h3 {
        font-size: 16px; /* å¢å¤§å® ç‰©æ ‡é¢˜å­—ä½“ */
        color: #6eb300; /* ç»¿è‰²æ ‡é¢˜ */
        text-shadow: 2px 2px #000000; /* æ·»åŠ æ–‡å­—é˜´å½± */
        margin: 0 0 8px 0; /* è°ƒæ•´æ ‡é¢˜é—´è· */
    }
    /* å® ç‰©çŠ¶æ€ */
    #pet-panel .status-item {
        background: transparent; /* é€æ˜èƒŒæ™¯ */
        border: none; /* æ— è¾¹æ¡† */
        padding: 4px 0; /* è°ƒæ•´é—´è· */
    }
    #pet-panel.show {
        opacity: 1;
    }
    /* ä¼˜åŒ–æŒ‰é’®é—´è· */
    .choice-btn {
        margin: 8px auto; /* ç»Ÿä¸€é—´è· */
        width: 95%; /* è‡ªé€‚åº”å®½åº¦ */
        max-width: 560px; /* æœ€å¤§å®½åº¦é™åˆ¶ */
    }
    /* ä¼˜åŒ–é¢æ¿å†…éƒ¨å¸ƒå±€ */
    #character-panel h3 {
        margin: 8px 0;
        font-size: 16px;
    }
    .status-item {
        padding: 3px;
        margin: 3px 0;
    }
    .puzzle-hint {
        color: #f0e6d2; /* æ›´äº®çš„ç±³é»„è‰²æ–‡å­— */
        border: 2px solid #6eb300; /* æ›´ç²—çš„ç»¿è‰²è¾¹æ¡† */
        padding: 12px;
        margin: 15px 0;
        background: #2d1b0fcc; /* æ›´æ·±çš„åŠé€æ˜èƒŒæ™¯ */
        box-shadow: 4px 4px 0 #00000033; /* æ·»åŠ åƒç´ é£é˜´å½± */
        font-family: 'zpix', cursive; /* ç»Ÿä¸€åƒç´ å­—ä½“ */
        font-size: 18px;
        line-height: 1.5;
        position: relative;
        border-radius: 4px; /* è½»å¾®åœ†è§’ */
    }
    .color-btn {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 3px solid #2d1b0f;
        margin: 10px;
        font-size: 32px;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .color-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 0 10px rgba(255,255,255,0.5);
    }
    /* ä¸åŒé¢œè‰²æŒ‰é’®çš„æ ·å¼ */
    .color-btn.red {
        background: #ff4444;
        text-shadow: 2px 2px #8b0000;
    }
    .color-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
    }
    .color-btn.blue {
        background: #4444ff;
        text-shadow: 2px 2px #00008b;
    }
    .color-btn.yellow {
        background: #ffff44;
        text-shadow: 2px 2px #8b8b00;
    }
    .color-btn.wood {
        background: #056b0b;
        text-shadow: 2px 2px #034110;
    }
    .color-btn.dirt {
        background: #b46702;
        text-shadow: 2px 2px #7e5c00;
    }
    .puzzle-success {
        color: #000000;
        animation: glow 1s ease-in-out;
    }
    .puzzle-fail {
        color: #ff5555;
        animation: shake 0.5s;
    }
    @keyframes glow {
        from { text-shadow: 0 0 10px #52e75a; }
        to { text-shadow: 0 0 20px #7ce662; }
    }
    @keyframes shake {
        0% { transform: translateX(0); }
        25% { transform: translateX(10px); }
        50% { transform: translateX(-10px); }
        75% { transform: translateX(5px); }
        100% { transform: translateX(0); }
    }
    .game-over-text {
        font-size: 24px;
        color: #ff5555;
        text-shadow: 2px 2px #8b0000;
        animation: game-over-pulse 1.5s infinite;
    }
    @keyframes game-over-pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    .pixel-timer {
        position: absolute;
        top: 10px;
        right: 10px;
        font-family: 'zpix', cursive;
        font-size: 24px;
        color: #ff5555;
        text-shadow: 2px 2px #8b0000;
        background-color: #2d1b0f;
        padding: 10px;
        border: 4px solid #6eb300;
        border-radius: 0;
        box-shadow: 4px 4px 0 #00000033;
        z-index: 1000;
        transition: opacity 0.3s ease;
    }
    .pixel-timer.hidden {
        opacity: 0;
        pointer-events: none;
    }
    /* è¯å…¸é¢æ¿æ ·å¼ */
    #dictionary-panel {
        position: fixed;
        top: 90px;
        right: 20px;
        width: 220px;
        padding: 15px;
        background: #2d1b0f;
        border: 4px solid #6eb300;
        border-radius: 0;
        font-family: 'zpix', cursive;
        font-size: 16px;
        color: #e3c9a1;
        opacity: 0;
        display: block;
        transform: scale(0.9);
        box-shadow: 6px 6px 0 #00000033;
        z-index: 1000;
        max-height: (90vh - 120px);
        overflow-y: auto;
        transition: all 0.3s ease;
    }

    #dictionary-panel.show {
        opacity: 1;
        transform: scale(1);
    }

    #dictionary-panel h3 {
        font-size: 20px;
        color: #6eb300;
        text-shadow: 2px 2px #000000;
        margin: 0 0 10px 0;
    }

    #item-detail-panel {
        display: none;
        margin-top: 15px;
        padding: 10px;
        background: #4a752c33;
        border: 2px solid; /* ç§»é™¤å›ºå®šé¢œè‰²ï¼Œç”±JSåŠ¨æ€è®¾ç½® */
        border-radius: 4px;
    }

    #item-detail-panel h3 {
        color: #6eb300;
        margin-top: 0;
    }
    
    #item-detail-quality {
    color: #ffff44; /* å“è´¨æ–‡å­—é¢œè‰² */
    margin: 5px 0;
    }

    #item-detail-price {
        font-style: italic;
        color: #ffff44;
    }

    .hidden {
        display: none;
    }
    /* é€šç”¨éŸ³é¢‘æ§åˆ¶æ¡æ ·å¼ */
    .audio-control {
        position: fixed;
        right: 10px;
        background: rgba(45, 27, 15, 0.8);
        padding: 5px 10px;
        border: 2px solid #6eb300;
        border-radius: 0;
        font-family: 'zpix', cursive;
        color: #e3c9a1;
        z-index: 9999;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* éŸ³ä¹æ§åˆ¶æ¡å•ç‹¬å®šä½ */
    #music-control {
        top: 10px;
    }

    /* éŸ³æ•ˆæ§åˆ¶æ¡å•ç‹¬å®šä½ */
    #sfx-control {
        top: 50px;
    }

    /* ç»Ÿä¸€æŒ‰é’®æ ·å¼ */
    .audio-control button {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        image-rendering: pixelated;
        padding: 0;
        margin: 0;
        line-height: 1;
    }

    /* ç»Ÿä¸€æ»‘å—æ ·å¼ */
    .audio-control input[type="range"] {
        width: 80px;
        height: 8px;
        background: #4a752c;
        outline: none;
        border: 1px solid #2d1b0f;
    }

    /* æ»‘å—æ‹‡æŒ‡æ ·å¼ */
    .audio-control input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 12px;
        height: 12px;
        background: #e3c9a1;
        border: 1px solid #2d1b0f;
    }

    /* ç»Ÿä¸€æ–‡å­—æ ·å¼ */
    .audio-control span {
        font-size: 16px;
        text-shadow: 1px 1px #2d1b0f;
        min-width: 30px;
    }
    </style>
    <script src="function/battle.js"></script>
    <script src="function/puzzle.js"></script>
    <script src="core/changePanel.js"></script>
    <script src="core/end_restart.js"></script>
    <script src="core/item.js"></script>
    <script src="core/audio.js"></script>
    <script src="function/enemies.js"></script>
    <script src="chapter/Prologue.js"></script>
    <script src="chapter/Chapter1.js"></script>
    <script src="chapter/Vallage.js"></script>
    <script src="chapter/Chapter1_2.js"></script>
    <script src="chapter/Thanks.js"></script>


</head>
<body>
    <!-- æ¬¢è¿ç•Œé¢ -->
    <div id="welcome-screen" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #2d1b0f;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-family: 'zpix', cursive;
        color: #e3c9a1;
        text-align: center;
        cursor: pointer;
        image-rendering: pixelated;
    ">
    <h1 style="font-size: 48px; margin-bottom: 30px; text-shadow: 3px 3px #6eb300;">
        æ¬¢è¿æ¥åˆ°å§‹ç¥–å¤§é™†ï¼
    </h1>
    <p style="font-size: 32px; line-height: 1.5; max-width: 80%;">
        è¿™æ˜¯ä¸€ä¸ªå……æ»¡ç¥ç§˜ä¸å†’é™©çš„ä¸–ç•Œ<br>
        ä½ çš„é€‰æ‹©å°†å†³å®šæ•…äº‹çš„èµ°å‘...<br>
        æ¸©é¦¨æç¤ºï¼šä½¿ç”¨ç”µè„‘ä½“éªŒæ›´ä½³<br>
        (bgmå’ŒéŸ³æ•ˆç³»ç»Ÿæœ‰ç‚¹é—®é¢˜ï¼Œè¯·è§è°…)
    </p>
    <div style="
        margin-top: 50px;
        padding: 10px 20px;
        border: 3px solid #6eb300;
        background: #4a752c33;
        animation: pulse 1.5s infinite;
    ">
        ç‚¹å‡»ä»»æ„ä½ç½®å¼€å§‹æ¸¸æˆ
    </div>
</div>

<style>
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
</style>
    <div id="character-panel">
        <h3>è§’è‰²çŠ¶æ€</h3>
        <div class="status-item">
            <span>ç”Ÿå‘½å€¼ï¼š</span>
            <span id="hp-value">100</span>
        </div>
        <div class="status-item">
            <span>æˆ˜æ–—åŠ›ï¼š</span>
            <span id="power-value">5</span>
        </div>
        <div class="status-item">
            <span>é‡‘&emsp;å¸ï¼š</span>
            <span id="gold-value">0</span>
        </div>
        <div class="status-item">
            <span>æ­»äº¡æ¬¡æ•°ï¼š</span>
            <span id="global-death-count">0</span> 
        </div>
        <h3>æŒæœ‰æ­¦å™¨</h3>
        <div id="weapon-container"></div> 
        <h3>æŒæœ‰ç‰©å“</h3>
        <div id="inventory-container"></div>
        <div id="pet-panel">
            <h3 id="pet-name">å® ç‰©åå­—</h3>
            <div class="status-item">
                <span>ç”Ÿå‘½å€¼ï¼š</span>
                <span id="pet-hp-value">0</span>
            </div>
            <div class="status-item">
                <span>æˆ˜æ–—åŠ›ï¼š</span>
                <span id="pet-power-value">0</span>
            </div>
        </div>
    </div>
    <div class="game-box">
        <div id="timer-display" class="pixel-timer hidden">10</div>
        <h1 id="chapter-title"></h1>
        <div id="content"></div>
    </div>
    <div id="dictionary-panel" class="hidden">
        <h3>ç‰©å“è¯å…¸</h3>
        <div id="dictionary-items-container"></div>
        <div id="item-detail-panel">
            <h3 id="item-detail-name"></h3>
            <img id="item-detail-icon" class="item-icon">
            <p id="item-detail-description"></p>
            <p id="item-detail-price"></p>
        </div>
    </div>

    <!-- éŸ³ä¹æ§åˆ¶é¢æ¿ -->
    <div id="music-control" class="audio-control">
        <button id="music-toggle">ğŸ”Š</button>
        <input type="range" id="volume-control" min="0" max="1" step="0.1" value="0.5">
        <span>éŸ³ä¹</span>
    </div>

    <!-- éŸ³æ•ˆæ§åˆ¶é¢æ¿ -->
    <div id="sfx-control" class="audio-control">
        <button id="sfx-toggle">ğŸ””</button>
        <input type="range" id="sfx-volume-control" min="0" max="1" step="0.1" value="0.7">
        <span>éŸ³æ•ˆ</span>
    </div>

    <!-- ç« èŠ‚èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bgm-prologue" loop src="audio/bgm/prologue.mp3"></audio>
    <audio id="bgm-chapter1" loop src="audio/bgm/chapter1.mp3"></audio>
    <audio id="bgm-chapter1_2" loop src="audio/bgm/chapter1_2.mp3"></audio>

    <!-- å…¨å±€æ§åˆ¶å™¨ -->
    <script>
        // åœ¨ HTML ä¸­å®šä¹‰å…¨å±€å˜é‡
        let globalDeathCount = parseInt(sessionStorage.getItem('globalDeathCount')) || 0;
        let characterData = {
            hp: 100,
            power: 5,
            gold: 0,
            weapon: null,
            inventory: ['ç»¿å®çŸ³'],
        };
        // åˆå§‹åŒ–å® ç‰©æ•°æ®
        let petData = {
            name: 'å® ç‰©åå­—',
            hp: 0,
            power: 0,
        };
        document.addEventListener('keydown', function(e) {
        // æ£€æŸ¥è¯å…¸æ˜¯å¦å·²è§£é”
        if (currentChapter === Chapter1_2 && e.key.toLowerCase() === 'd') {
            ItemSystem.showDictionary();
        }
        });
    </script>
    <script>
        let currentChapter = null;
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            localStorage.removeItem('gameData');
            currentChapter = Prologue;
            currentChapter.initialize(); // è°ƒç”¨ç« èŠ‚åˆå§‹åŒ–æ–¹æ³•
            initAudio();
        }
        
        // å…¨å±€é€‰æ‹©å¤„ç†å™¨
        function handleChoice(choice) {
        // æ£€æµ‹ç« èŠ‚åˆ‡æ¢ï¼ˆä¾‹å¦‚ä»åºç« åˆ°ç¬¬ä¸€ç« ï¼‰
            if (choice === 'd0') {
                currentChapter = Chapter1;
                currentChapter.initialize();
                return;
            }
            else if (choice === 'z0') {
                currentChapter = Vallage;
                currentChapter.initialize();
                return;
            }
            else if (choice === 'b0') {
                currentChapter = Chapter1_2;
                currentChapter.initialize();
                return;
            }
            else if (choice === 'T0') {
                currentChapter = Thanks;
                currentChapter.initialize();
                return;
            }

            // æ­£å¸¸å¤„ç†é€‰æ‹©
            currentChapter.handleChoice(choice);
        }

        window.onload = initGame;
        
        const GameTimer = { 
        // åˆå§‹åŒ–è®¡æ—¶ï¼ˆåœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨ï¼‰
            start() {
                // å¦‚æœå·²æœ‰ startTimeï¼Œè¯´æ˜æ˜¯é¡µé¢åˆ·æ–°ï¼Œä¸é‡ç½®
                if (!sessionStorage.getItem('gameStartTime')) {
                    sessionStorage.setItem('gameStartTime', performance.now());
                }
            },

            // è·å–æ€»æ¸¸ç©æ—¶é—´ï¼ˆè¿”å›æ¯«ç§’æ•°ï¼Œå¯è‡ªè¡Œæ ¼å¼åŒ–ï¼‰
            getPlayTime() {
                const startTime = parseFloat(sessionStorage.getItem('gameStartTime'));
                if (!startTime) return 0;
                return performance.now() - startTime;
            }
        };
        GameTimer.start();

    </script>
</body>
</html>